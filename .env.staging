# =============================================================================
# 测试环境配置 (Staging)
# =============================================================================
# 此文件用于测试/预发布环境
# 使用命令切换到此环境：./switch-env.sh staging
# =============================================================================

# =============================================================================
# 项目基础配置
# =============================================================================
PROJECT_NAME="HeyGO AI SkiCoach Backend [STAGING]"
STACK_NAME=heygo-ai-skicoach-staging
ENVIRONMENT=staging

# 域名配置（根据实际测试域名修改）
DOMAIN=staging.yourdomain.com
FRONTEND_HOST=https://staging.yourdomain.com

# =============================================================================
# 安全配置（使用中等强度密码）
# =============================================================================
SECRET_KEY=staging-secret-key-change-me-in-deployment
FIRST_SUPERUSER=13800138000
FIRST_SUPERUSER_PASSWORD=Staging@2024

# =============================================================================
# 数据库配置
# =============================================================================
POSTGRES_SERVER=db
POSTGRES_PORT=5432
POSTGRES_DB=app_staging
POSTGRES_USER=postgres
POSTGRES_PASSWORD=staging_db_password_2024

# =============================================================================
# Redis 配置
# =============================================================================
REDIS_URL=redis://redis:6379/0

# =============================================================================
# CORS 配置
# =============================================================================
BACKEND_CORS_ORIGINS="https://staging.yourdomain.com,http://staging.yourdomain.com"

# =============================================================================
# 邮件服务配置
# =============================================================================
SMTP_HOST=smtp.example.com
SMTP_USER=staging@example.com
SMTP_PASSWORD=smtp_password_here
EMAILS_FROM_EMAIL=staging@example.com
SMTP_TLS=True
SMTP_SSL=False
SMTP_PORT=587

# =============================================================================
# 短信服务配置
# =============================================================================
SMS_SERVICE=mock  # 测试环境可以使用 mock 或真实服务
SMS_ACCESS_KEY=
SMS_SECRET_KEY=
SMS_SIGN_NAME=AI滑雪教练
SMS_TEMPLATE_CODE=

# =============================================================================
# 监控配置
# =============================================================================
SENTRY_DSN=https://your-sentry-dsn@sentry.io/staging-project-id

# =============================================================================
# Docker 配置
# =============================================================================
DOCKER_IMAGE_BACKEND=backend
DOCKER_IMAGE_FRONTEND=frontend
TAG=staging

# =============================================================================
# 性能配置（测试环境中等规模）
# =============================================================================

# Gunicorn 配置（测试环境中等 workers）
GUNICORN_WORKERS=5
GUNICORN_WORKER_CONNECTIONS=500
GUNICORN_MAX_REQUESTS=1000
GUNICORN_MAX_REQUESTS_JITTER=50
GUNICORN_TIMEOUT=120
GUNICORN_KEEPALIVE=5
GUNICORN_GRACEFUL_TIMEOUT=30
GUNICORN_LOG_LEVEL=info

# 数据库连接池配置（测试环境中等连接池）
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_POOL_PRE_PING=True
DB_ECHO=False

# TimescaleDB 配置（测试环境使用更激进的策略）
TIMESCALE_COMPRESS_AFTER_DAYS=3  # 3天后压缩
TIMESCALE_COMPRESS_SEGMENT_BY=session_id
TIMESCALE_COMPRESS_ORDER_BY="timestamp DESC"

TIMESCALE_RETENTION_SENSOR_DATA_DAYS=180  # 传感器数据保留 180 天
TIMESCALE_RETENTION_METRICS_DATA_DAYS=365  # 指标数据保留 1 年

TIMESCALE_REFRESH_INTERVAL_HOURS=1
TIMESCALE_REFRESH_START_OFFSET_HOURS=3
TIMESCALE_REFRESH_END_OFFSET_HOURS=1

# PostgreSQL 配置（测试环境 2-4GB 内存）
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_SHARED_BUFFERS=512MB
POSTGRES_EFFECTIVE_CACHE_SIZE=2GB
POSTGRES_WORK_MEM=8MB
POSTGRES_MAINTENANCE_WORK_MEM=128MB
POSTGRES_WAL_BUFFERS=16MB
POSTGRES_MIN_WAL_SIZE=1GB
POSTGRES_MAX_WAL_SIZE=2GB
POSTGRES_MAX_WORKER_PROCESSES=6
POSTGRES_MAX_PARALLEL_WORKERS=6
POSTGRES_MAX_PARALLEL_WORKERS_PER_GATHER=3

# 性能监控配置
ENABLE_QUERY_LOGGING=True
SLOW_QUERY_THRESHOLD_MS=1000
